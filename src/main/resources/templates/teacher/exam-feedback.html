<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/header :: head}"></head>

<body class="bg-white">

<style>
  .border-success {
    border-width: 4px !important; /* Adjust the thickness as needed */
  }

  .border-danger {
    border-width: 4px !important; /* Adjust the thickness as needed */
  }

  .bold-text {
    font-weight: bold; /* 또는 font-weight: 700; */
  }
</style>

<!-- --------------------------- [FRAGMENT : 상단 네이게이션바]  ------------------------------------->
<div th:replace="~{fragments/top-nav :: top-nav}"></div>

<div id="layoutSidenav">
  <div id="layoutSidenav_nav">
  </div>
  <div id="layoutSidenav_content">
    <main>

      <!-- --------------------------- [FRAGMENT : 배너]  ------------------------------------->
      <div th:replace="~{fragments/top-banner :: top-banner}"></div>

      <!-- --------------------------- [중앙 : 컨텐츠 START]  ------------------------------------->

      <div class="container-xl px-4 mt-n10">
        <!-- Wizard card example with navigation-->
        <div class="card">
          <div class="card-header border-bottom">
            <!-- Wizard navigation-->
            <div class="nav nav-pills nav-justified flex-column flex-xl-row nav-wizard">

              <!-- Wizard navigation item 1-->
              <a href="#wizard1" class="nav-item nav-link active">
                <div class="wizard-step-icon">1</div>
                <div class="wizard-step-text">
                  <div class="wizard-step-text-name">학생 시험 결과 확인</div>
                  <div class="wizard-step-text-details">학생이 제출한 시험 내용을 확인합니다.</div>
                </div>
              </a>

              <!-- Wizard navigation item 2 -->
              <a href="#wizard2" class="nav-item nav-link">
                <div class="wizard-step-icon">2</div>
                <div class="wizard-step-text">
                  <div class="wizard-step-text-name">피드백 작성</div>
                  <div class="wizard-step-text-details">제출한 시험 내용을 바탕으로 피드백을 작성합니다.</div>
                </div>
              </a>

              <!-- Wizard navigation item 3 -->
              <a href="#wizard3" class="nav-item nav-link">
                <div class="wizard-step-icon">3</div>
                <div class="wizard-step-text">
                  <div class="wizard-step-text-name">학생 수준 평가</div>
                  <div class="wizard-step-text-details">학생의 수준을 평가합니다.</div>
                </div>
              </a>

              <!-- Wizard navigation item 4-->
              <a href="#wizard4" class="nav-item nav-link">
                <div class="wizard-step-icon">4</div>
                <div class="wizard-step-text">
                  <div class="wizard-step-text-name">제출하기</div>
                  <div class="wizard-step-text-details">작성한 내용을 제출합니다.</div>
                </div>
              </a>
            </div>
          </div>

          <div class="card-body">
            <div class="tab-content" id="cardTabContent">

              <!-- Wizard tab pane item 1 -->
              <div id="wizard1" class="tab-pane py-1 fade show active" role="tabpanel"
                   aria-labelledby="wizard1-tab">
                <h2>학생 시험 결과 확인</h2>
                <p style="font-size: 20px; font-weight: bold; margin-bottom: 8px; color:black">
                  시험 제목: <strong th:text="${examTitle}"></strong>
                </p>
                <!-- 문제출제 div 박스 -->
                <div class="row">
                  <div class="col-lg-12">
                    <div id="questions-container" class="mt-4">
                      <!-- 질문들이 이곳에 추가됩니다 -->
                    </div>
                  </div>
                </div>
              </div>

              <!-- Wizard tab pane item 2 -->
              <div id="wizard2" class="tab-pane py-1 fade" role="tabpanel"
                   aria-labelledby="wizard2-tab">
                <h2>피드백 작성</h2>
                <!-- 피드백 작성 & GPT 추천 -->
                <div class="row">
                  <div class="col-lg-12">
                    <div class="card">
                      <div class="card-header">
                        <h1>선생님 피드백</h1>
                      </div>

                      <div class="card-body mb-3 justify-content-center">
                        <form>
<textarea class="form-control" rows="15">
    피드백 입니다.
피드백 입니다.
피드백 입니다.
    피드백 입니다.
피드백 입니다.
</textarea>
                          <div class="d-flex justify-content-center mt-4 mb-3">
                            <button class="btn btn-primary" type="button">피드백 저장</button>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Wizard tab pane item 3 -->
              <div id="wizard3" class="tab-pane py-1 fade" role="tabpanel"
                   aria-labelledby="wizard3-tab">
                <h2>학생 수준 평가</h2>
                <!-- 해당 섹션에 필요한 추가 내용 추가 -->
              </div>

              <!-- Wizard tab pane item 4 -->
              <div id="wizard4" class="tab-pane py-1 fade" role="tabpanel"
                   aria-labelledby="wizard4-tab">
                <h2>제출하기</h2>
                <!-- 내용 추가 -->
              </div>

            </div>
          </div>
        </div>
      </div>

      <!-- --------------------------- [중앙 : 컨텐츠 END]  ------------------------------------->

    </main>

    <!-- --------------------------- [FRAGMENT : 하단] ------------------------------------->
    <footer th:replace="~{fragments/footer :: footer}"></footer>

  </div>
</div>

<!-- 공통 <script> 포함 -->
<div th:replace="~{fragments/scripts :: scripts}"></div>

<!-- jQuery (필요한 경우) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script th:inline="javascript">
  // JavaScript 변수에 Thymeleaf 데이터를 할당
  const examSeq = /*[[${examSeq}]]*/ null;
  const teacherQuestions = /*[(${teacherQuestions})]*/ [];
  const lectureSubjects = /*[(${lectureSubjects})]*/ [];

  document.addEventListener('DOMContentLoaded', function () {
    var triggerTabList = [].slice.call(document.querySelectorAll('.nav-wizard a'));

    triggerTabList.forEach(function (triggerEl) {
      triggerEl.addEventListener('click', function (event) {
        event.preventDefault();

        // 모든 탭의 활성화 상태를 초기화
        triggerTabList.forEach(function (el) {
          el.classList.remove('active');
        });
        // 클릭한 탭을 활성화
        triggerEl.classList.add('active');

        // 모든 탭 내용 비활성화
        var tabContentList = document.querySelectorAll('.tab-pane');
        tabContentList.forEach(function (content) {
          content.classList.remove('show', 'active');
        });

        // 클릭한 탭에 해당하는 내용 활성화
        var target = document.querySelector(triggerEl.getAttribute('href'));
        if (target) {
          target.classList.add('show', 'active');
          target.scrollIntoView({behavior: 'smooth', block: 'start'});
        }
      });
    });

    // 질문 데이터를 렌더링하는 부분 추가
    const questionsContainer = document.getElementById('questions-container');

    teacherQuestions.forEach((question, index) => {
      // 질문 번호
      const questionCount = index + 1;

      // 정답 여부에 따른 글씨 색상 결정
      const questionClass = question.correctAnswer === question.studentAnswer ? 'text-success'
          : 'text-danger';

      // 각 질문의 HTML 구조
      const questionHTML = `
    <div class="card mb-4 question-set" id="question-${questionCount}">
        <div class="card-header d-flex justify-content-between ${questionClass}">
            <strong> 문제 ${questionCount} </strong>
        </div>
        <div class="card-body">
            <form>
                <div class="mb-3">
                    <label class="small mb-1"><b>문제 내용</b></label>
                    <textarea class="form-control auto-resize question-direction" rows="1" disabled>${question.direction}</textarea>
                </div>
                <div class="mb-0">
                    ${question.choices.map((choice, idx) => `
                        <div class="form-check mb-2 d-flex align-items-center
                            ${(idx + 1 === question.correctAnswer ? 'border border-success' : '')}
                            ${(idx + 1 === question.studentAnswer && idx + 1
      !== question.correctAnswer ? 'border border-danger' : '')}"
                           style="
                                ${(idx + 1 === question.correctAnswer) ? 'border: 5px solid green;'
          : ''}
                                ${(idx + 1 === question.studentAnswer && idx + 1
          !== question.correctAnswer)
          ? 'border: 5px solid red;' : ''}
                            ">
                            <label class="form-check-label me-3 ${idx + 1 === question.correctAnswer
          ? 'bold-text' : ''}">${idx + 1}</label>
                            <textarea class="form-control auto-resize ${idx + 1
      === question.correctAnswer ? 'bold-text' : ''}" rows="1" disabled>${choice}</textarea>
                        </div>
                    `).join('')}
                </div>
                <div class="mb-3">
                    <label class="small mb-1"><b>정답</b></label>
                    <select class="form-control correct-answer" disabled>
                        ${question.choices.map((_, idx) => `
                            <option value="${idx + 1}" ${idx + 1 === question.correctAnswer
          ? 'selected' : ''}>${idx + 1}</option>
                        `).join('')}
                    </select>
                </div>
                <div class="mb-3">
                    <label class="small mb-1"><b>출제의도</b></label>
                    <textarea class="form-control auto-resize question-intent" rows="1" disabled>${question.intent}</textarea>
                </div>
            </form>
        </div>
    </div>
`;

      // 컨테이너에 추가
      questionsContainer.insertAdjacentHTML('beforeend', questionHTML);
    });
  });
</script>

</body>
</html>
